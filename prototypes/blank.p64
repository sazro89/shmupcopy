picotron cartridge // www.picotron.net
version 2

:: gfx/
:: gfx/0.gfx
b64$LS1bW3BvZCxjcmVhdGVkPSIyMDI0LTA5LTIyIDA5OjIxOjQxIixtb2RpZmllZD0iMjAyNC0x
MC0wNiAwNDowNTo1MSIscmV2aXNpb249Nzc5XV1sejQABwQAAKk2AADzIXtbMF09e2JtcD1weHUA
QyAQEATwVgcQB8AX0BfABxAH8FYsZmxhZ3M9MCxwYW5feAgA2nk9MCx6b29tPTEyfSw-AE-yAe0C
AgAID08AHX-9AdYdBr0FBAAbP8X9AWgAHSkCDQIAXv0BAv0PAwAPVgAdMQoQGgIABAgAKxoACAAf
ECIAUw_4AB0v8PAyAIHwDWARwAEHBgGwIQ0BkAEsEYABDBccEXABDAcMAQwIAEAhDCFgBgDwGQEH
AVARHAEHEQYBUAENAQwHEQ0GDQEwAS0hDQYNBw0BIAEdBi0GDRYKAP8PDQYHFgcGDQYdATABBwYN
AQYHDSFQAQURFQ0RcGEwogAhLwYHogAEIGARogAiUBGiAJBAAQYBHBEHAQYKAGANAQwXEQaQAPQE
PTEdBgcBEAEdFj0GDRYBEAENFqEA-wIgEQcdEQcxQAEGFQEVDRFgcZ8AIoAWAaBRkAE8AZwAICwB
nADwARwBDAFQIQwxDCEwAQcBDDGeAGAwAQYRBxFCAQAjATENERdDARAAIwH2BAYNMQ0GDQYHESYN
Bj0GDSYRHQZFAf8DADEHARYBBzEwAQYBBREFAQYBpwAk8QQHBgGgAQ0hoBEsAYARDBccAXARRgGA
AWAhDCEMEVCqAAEIAPACBgEHERwBBgEwAQ0GERcMAQ2zAOAHBh0xPQEQARYNBj0WHU8BAqQAAPMB
zzEHER0HEUARDRUBFZ8AJi8GB58ACSIBYJ8AIAFgRwFBARwRQEUBMAcMAYcCcA0HDQYNIS1aAUAW
DQYt2gEVAUQBYAEwIQ0HBpcCvwFQEQ0VEQUBcGFAjQOBDzIAHP8FBAYEAB8YAA4XHhceHxceHQ4A
HgBBABp-CAgEIAfwLDQAH49QBwwHUAfwHDoAIL8nQAcMB0AX0AfwBT4AJgNCAD9gB0BDACIFRQB-
UAdgB1AHQNkBfvIQCBAEIBlQGUAJFwkwCRcJIAk3CRAJNwkACQcKFwoHGQYAMRoXGgQA-wYKCRoJ
CjkaWRo5ADkAGRAZEAkgGSBvACEAcQA1GgkwdQBYChcKCRAGADEZGhkEABFZAgBvCQAZAAkwawAl
DG8AMjAJGgQAEjkCAF9AGVAZIGcBHv8HNxewV4B3cHdgl1CXUJdgd4BXoDfwFkcAHfEEYBfQF9AX
oAcQFxAHYBcANwAXUAYA-wBgd1AHAHcABzC3QJdgd3BeACRg8AQHUAdwPwP-EwsX0BdwB0AXQAcg
ByA3IAdgV5BXYAcQVxAHYFegN8AX8BdcAB0QMFcAYTQH0AfwIVgAX3AXwDewSgAiL-DwMgD-----
----------------------------------------------------9VA9MTJ9fQ==
:: gfx/.info.pod
b64$LS1bW3BvZCxjcmVhdGVkPSIyMDI0LTA5LTIyIDEwOjQ5OjA5Iixtb2RpZmllZD0iMjAyNC0x
MC0wNiAwNDowNTo1MSJdXQ==
:: map/
:: map/0.map
b64$LS1bW3BvZCxjcmVhdGVkPSIyMDI0LTA5LTIyIDA5OjIxOjQxIixtb2RpZmllZD0iMjAyNC0x
MC0wNiAwNDowNTo1MSIscmV2aXNpb249NzUzXV1sejQA-gAAAFUIAAD-EXt7Ym1wPXVzZXJkYXRh
KCJpMTYiLDMwLDE3LCIwMDA0BABoHzEEAFkPeAB4EzIEAB8xBAAECCAACDwACBgADgQADiAACDwA
DiAADgQACCAACDwACBgADgQADiAACDwADwQAGRszBAAfMQQAEQ94ADAOxAAPeABTGzMEAB8xeABU
D-AA-6YPxAANCCAACDwACBgADgQADiAACDwADiAADgQACCAACDwACBgADgQADiAACDwADwQATg94
AHgPBABe8QkiKSxoaWRkZW49ZmFsc2UscGFuX3g9LTMJAOJ5PS0xLHRpbGVfaD0xNgoAEHcKALB6
b29tPTAuMjV9fQ==
:: map/.info.pod
b64$LS1bW3BvZCxjcmVhdGVkPSIyMDI0LTA5LTIyIDEwOjQ5OjA5Iixtb2RpZmllZD0iMjAyNC0x
MC0wNiAwNDowNTo1MSJdXQ==
:: sfx/
:: sfx/0.sfx
b64$LS1bW3BvZCxjcmVhdGVkPSIyMDI0LTA5LTIyIDA5OjIxOjQxIixtb2RpZmllZD0iMjAyNC0x
MC0wNiAwNDowNTo1MSIscmV2aXNpb249NzQ3XV1sejQAzgAAAEkKAAD-MHB4dQADKAAABAAED0AQ
Ag4AAaABIAKgDgAPEAAN8MoBAgNADw_QBAUGB0AMkAgJCgtADJAPDA8NDw4MQAzw-wEA6-8nqgEQ
Bg8gEAEgASAB8AACEAIOEAEgDyEgATAPQPDDDygP--DGD-gKD-8PgA-3Dw0B8AkBEAYOMAD-----
-70f-wEArPAByA9AAA8QQA8NfA0cDw4PDAQAANsH8gYPHAYKKRhZSJdWRwgHCAkK8TCO8KcsAF--
-7DwcAsAAh--AQD-5lD-----TQ==
:: sfx/.info.pod
b64$LS1bW3BvZCxjcmVhdGVkPSIyMDI0LTA5LTIyIDEwOjQ5OjA5Iixtb2RpZmllZD0iMjAyNC0x
MC0wNiAwNDowNTo1MSJdXQ==
:: main.lua
--[[pod_format="raw",created="2024-09-22 09:21:41",modified="2024-10-06 04:05:51",revision=1011]]
butdic={ 	-- 0 - stop
	1, 		-- 1  - left
	2, 		-- 2  - right
	0, 		-- 3  - stop l+r
	3, 		-- 4  - up
	5, 		-- 5  - diag u+l
	6, 		-- 6  - diag u+r
	3, 		-- 7  - up u+l+r
	4, 		-- 8  - down
	8, 		-- 9  - diag d+l
	7, 		-- 10 - diag d+r
	4, 		-- 11 - down r+l+d
	0, 		-- 12 - stop u+d
	1, 		-- 13 - left l+u+d
	2, 		-- 14 - right r+u+d
	0  		-- 15 - stop l+r+u+d
}
butdic[0] = 0
dirx = {-1, 1, 0, 0,-0.75, 0.75, 0.75,-0.75}
diry = { 0, 0,-1, 1,-0.75,-0.75, 0.75, 0.75}
shiparr = {8,9,10,11,12}
shipspr = 0
shots = {}
shotwait = 0

wep = 2
muzz = {}

banked = 0


function _init()
	px,py = 240,135
	spd = 1.537
	lastdir = 0
	t = 0 -- timer variable
	cls(0)
end

function _draw()
	cls(12)
--	map()

	for s in all(shots) do
		spr(s.sani[flr(s.si)],s.x+6,s.y)
	end
	
	for m in all(muzz) do
		spr(m.sani[flr(m.si)],px+m.x,py+m.y)
	end
	spr(shiparr[flr(shipspr*2.4+3.5)],px,py)
	
	local flamearr={17,18,17,19,18,20,19,21}
	local fframe = (t % (#flamearr - 1)) + 1
	
	spr(flamearr[fframe],px+6-banked,py+14,true)
	spr(flamearr[fframe],px+2+banked,py+14)
	
--	local btnval = btn()&0b1111
--	print(shipspr*2.4+3.5,5,5,7)
--	print(butdic[btnval],5,14,7)
	print("shots: "..#shots,2,2,7)
end

function _update()
	t += 1
	local dir = butdic[btn()&0b1111]
	
	if lastdir != dir and dir >= 5 then
		px = flr(px) -- or flr(px) + 0.5
		py = flr(py) -- or flr(py) + 0.5
	end
	
	local dshipspr = 0
	banked = 0
	
	if dir > 0 then
		px+=dirx[dir] * spd
		py+=diry[dir] * spd
		
		dshipspr = mysgn(dirx[dir])
		banked = 1
	end
	
	shipspr += mysgn(dshipspr-shipspr)*0.18
	shipspr = mid(-1, shipspr, 1)
	
	lastdir = dir
	if shotwait > 0 then
		shotwait -= 1
	end
	
	-- shooting
	if btn(4) then
		if wep == 1 then
			shot_raiden()
		elseif wep == 2 then
			shot_ddp()
		end
	end
	
	doshots()
	domuzz()
end

function doshots()
	for s in all(shots) do
		s.x += s.sx
		s.y += s.sy
		s.si += 0.5
		
		if flr(s.si) > #s.sani then
			s.si = 1
		end
		if s.y < -16 then
			del(shots,s)
		end
	end
end

function domuzz()
	for m in all(muzz) do
		m.si += 1
		
		if flr(m.si) > #m.sani then
			del(muzz,m)
		end
	end
end

function mysgn(v)
	return v == 0 and 0 or sgn(v)
end

function shot_raiden()
	if shotwait <= 0 and #shots < 6 then
		local shotspd = -3.5
		shotwait = 4
		add(shots,{
			x = px-3,
			y = py+9,
			sx = 0,
			sy = shotspd,
			sani = {16},
			si = 1
		})
		add(shots,{
			x = px+3,
			y = py+9,
			sx = 0,
			sy = shotspd,
			sani = {16},
			si = 1
		})
	end
end

function shot_ddp()
	if shotwait <= 0 and #shots < 14 then
		local shotspd = -12
		shotwait = 3
		add(shots,{
			x = px-6,
			y = py,
			sx = 0,
			sy = shotspd,
			sani = {24,25,26,25},
			si = t%4+1
		})
		add(shots,{
			x = px+2,
			y = py,
			sx = 0,
			sy = shotspd,
			sani={24,25,26,25},
			si = t%4+1
		})
		add(muzz, {
			x = -4,
			y = -8,
			sani = {27,28,29,30},
			si = 0
		})
		add(muzz, {
			x = 4,
			y = -8,
			sani = {27,28,29,30},
			si = 0
		})
	end
end
:: .info.pod
b64$LS1bW3BvZCxjcmVhdGVkPSIyMDI0LTA5LTIyIDA5OjIyOjM5Iixtb2RpZmllZD0iMjAyNC0x
MC0wNiAwNDowNTo1MSIscnVudGltZT0xMSx3b3Jrc3BhY2VzPXt7bG9jYXRpb249Im1haW4ubHVh
IzE4OCIsd29ya3NwYWNlX2luZGV4PTF9LHtsb2NhdGlvbj0iZ2Z4LzAuZ2Z4Iix3b3Jrc3BhY2Vf
aW5kZXg9Mn0se2xvY2F0aW9uPSJtYXAvMC5tYXAiLHdvcmtzcGFjZV9pbmRleD0zfSx7bG9jYXRp
b249InNmeC8wLnNmeCIsd29ya3NwYWNlX2luZGV4PTR9fV1d
:: [eoc]
